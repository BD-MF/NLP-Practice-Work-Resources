# 【高频】Dropout
## 目录：
1.Dropout 简介
* Dropout出现的原因
* 什么是Dropout

2.Dropout工作流程及使用

* Dropout具体工作流程
* Dropout在神经网络中的使用

3.为什么说Dropout可以解决过拟合

### Dropout 简介
#### Dropout出现的原因
     
   在机器学习的模型中，如果模型的参数太多，而训练样本又太少，训练出来的模型很容易产生过拟合的现象。在训练神经网络的时候经常会遇到过拟合的问题，过拟合具体表现在：模型在训练数据上损失函数较小，预测准确率较高；但是在测试数据上损失函数比较大，预测准确率较低。过拟合是很多机器学习的通病。如果模型过拟合，那么得到的模型几乎不能用。为了解决过拟合问题，一般会采用模型集成的方法，即训练多个模型进行组合。此时，训练模型费时就成为一个很大的问题，不仅训练多个模型费时，测试多个模型也是很费时。综上所述，训练深度神经网络的时候，总是会遇到两大缺点：（1）容易过拟合（2）费时Dropout可以比较有效的缓解过拟合的发生，在一定程度上达到正则化的效果。
#### 什么是Dropout
  

   在2012年，Hinton在其论文《Improving neural networks by preventing co-adaptation of feature detectors》中提出Dropout。当一个复杂的前馈神经网络被训练在小的数据集时，容易造成过拟合。为了防止过拟合，可以通过阻止特征检测器的共同作用来提高神经网络的性能。在2012年，Alex、Hinton在其论文《ImageNet Classification with Deep Convolutional Neural Networks》中用到了Dropout算法，用于防止过拟合。并且，这篇论文提到的AlexNet网络模型引爆了神经网络应用热潮，并赢得了2012年图像识别大赛冠军，使得CNN成为图像分类上的核心算法模型。随后，又有一些关于Dropout的文章《Dropout:A Simple Way to Prevent Neural Networks from Overfitting》、《Improving Neural Networks with Dropout》、《Dropout as data augmentation》。从上面的论文中，我们能感受到Dropout在深度学习中的重要性。那么，到底什么是Dropout呢？Dropout可以作为训练深度神经网络的一种trick供选择。在每个训练批次中，通过忽略一半的特征检测器（让一半的隐层节点值为0），可以明显地减少过拟合现象。这种方式可以减少特征检测器（隐层节点）间的相互作用，检测器相互作用是指某些检测器依赖其他检测器才能发挥作用。Dropout说的简单一点就是：我们在前向传播的时候，让某个神经元的激活值以一定的概率p停止工作，这样可以使模型泛化性更强，因为它不会太依赖某些局部的特征，如下图：
   ![image](https://user-images.githubusercontent.com/59279781/120581171-ea304780-c45c-11eb-9de0-cf4cc2bb9322.png)

   
  
### Dropout工作流程及使用
 
#### Dropout具体工作流程
假设我们要训练这样一个神经网络，如下图所示：
  ![image](https://user-images.githubusercontent.com/59279781/120581235-09c77000-c45d-11eb-9309-1aa8f0b97ce9.png)
输入是x输出是y，正常的流程是：我们首先把x通过网络前向传播，然后把误差反向传播以决定如何更新参数让网络进行学习。使用Dropout之后，过程变成如下：
（1）首先随机（临时）删掉网络中一半的隐藏神经元，输入输出神经元保持不变（图3中虚线为部分临时被删除的神经元）
![image](https://user-images.githubusercontent.com/59279781/120581271-1cda4000-c45d-11eb-9612-57ebd3143a9e.png)

（2） 然后把输入x通过修改后的网络前向传播，然后把得到的损失结果通过修改的网络反向传播。一小批训练样本执行完这个过程后，在没有被删除的神经元上按照随机梯度下降法更新对应的参数（w，b）。

（3）然后继续重复这一过程：
    * 恢复被删掉的神经元（此时被删除的神经元保持原样，而没有被删除的神经元已经有所更新）
    * 从隐藏层神经元中随机选择一个一半大小的子集临时删除掉（备份被删除神经元的参数）。
    * 对一小批训练样本，先前向传播然后反向传播损失并根据随机梯度下降法更新参数（w，b） （没有被删除的那一部分参数得到更新，删除的神经元参数保持被删除前的结果）。

#### Dropout在神经网络中的使用
  
  Dropout的具体工作流程上面已经详细的介绍过了，但是具体怎么让某些神经元以一定的概率停止工作（就是被删除掉）？代码层面如何实现呢？下面，我们具体讲解一下Dropout代码层面的一些公式推导及代码实现思路。
  （1）在训练模型阶段，无可避免的，在训练网络的每个单元都要添加一道概率流程。
      ![image](https://user-images.githubusercontent.com/59279781/120581398-56ab4680-c45d-11eb-8695-b5fab0b9719b.png)

   对应的公式变化如下：
   * 没有Dropout的网络计算公式：
        ![image](https://user-images.githubusercontent.com/59279781/120581465-72165180-c45d-11eb-940f-298c884f4bae.png)
      
   * 采用Dropout的网络计算公式：
        ![image](https://user-images.githubusercontent.com/59279781/120581481-7b072300-c45d-11eb-8833-0c3701575b5a.png)

  上面公式中Bernoulli函数是为了生成概率r向量，也就是随机生成一个0、1的向量。代码层面实现让某个神经元以概率p停止工作，其实就是让它的激活函数值以概率p变为0。比如我们某一层网络神经元的个数为1000个，其激活函数输出值为y1、y2、y3、......、y1000，我们dropout比率选择0.4，那么这一层神经元经过dropout后，1000个神经元中会有大约400个的值被置为0。注意： 经过上面屏蔽掉某些神经元，使其激活值为0以后，我们还需要对向量y1……y1000进行缩放，也就是乘以1/(1-p)。如果你在训练的时候，经过置0后，没有对y1……y1000进行缩放（rescale），那么在测试的时候，就需要对权重进行缩放，操作如下。

  （2）在测试模型阶段
    预测模型的时候，每一个神经单元的权重参数要乘以概率p。
        ![image](https://user-images.githubusercontent.com/59279781/120581615-ae49b200-c45d-11eb-9f65-8c662d942f5b.png)
        
### 为什么说Dropout可以解决过拟合

（1）取平均的作用： 先回到标准的模型即没有dropout，我们用相同的训练数据去训练5个不同的神经网络，一般会得到5个不同的结果，此时我们可以采用 “5个结果取均值”或者“多数取胜的投票策略”去决定最终结果。例如3个网络判断结果为数字9,那么很有可能真正的结果就是数字9，其它两个网络给出了错误结果。这种“综合起来取平均”的策略通常可以有效防止过拟合问题。因为不同的网络可能产生不同的过拟合，取平均则有可能让一些“相反的”拟合互相抵消。dropout掉不同的隐藏神经元就类似在训练不同的网络，随机删掉一半隐藏神经元导致网络结构已经不同，整个dropout过程就相当于对很多个不同的神经网络取平均。而不同的网络产生不同的过拟合，一些互为“反向”的拟合相互抵消就可以达到整体上减少过拟合。

（2）减少神经元之间复杂的共适应关系： 因为dropout程序导致两个神经元不一定每次都在一个dropout网络中出现。这样权值的更新不再依赖于有固定关系的隐含节点的共同作用，阻止了某些特征仅仅在其它特定特征下才有效果的情况 。迫使网络去学习更加鲁棒的特征 ，这些特征在其它的神经元的随机子集中也存在。换句话说假如我们的神经网络是在做出某种预测，它不应该对一些特定的线索片段太过敏感，即使丢失特定的线索，它也应该可以从众多其它线索中学习一些共同的特征。从这个角度看dropout就有点像L1，L2正则，减少权重使得网络对丢失特定神经元连接的鲁棒性提高。

（3）Dropout类似于性别在生物进化中的角色：物种为了生存往往会倾向于适应这种环境，环境突变则会导致物种难以做出及时反应，性别的出现可以繁衍出适应新环境的变种，有效的阻止过拟合，即避免环境改变时物种可能面临的灭绝。
